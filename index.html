<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Samir's Test Site | Customer.io Sandbox</title>
    <!-- Load Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom font */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f7f9;
        }
        .cio-page-content {
            min-height: 50vh;
        }
        /* Ensure consistent button/link styling in the header */
        #auth-actions > * {
            margin-left: 0.5rem; /* Add spacing between link/button */
        }
    </style>
</head>
<body class="antialiased">

    <!-- 
        =========================================================
        CUSTOMER.IO TRACKING SNIPPET (LIVE - CDP CLIENT)
        =========================================================
        NOTE: This is the full snippet provided by the user (using the 
        global variable 'cioanalytics' and Write Key '58f554b322734a6ae65d'). 
        All application logic below has been updated to use 'cioanalytics.identify()', 
        'cioanalytics.page()', and 'cioanalytics.reset()'.
    -->
    <script id="cio-live-snippet">
        !function(){var i="cioanalytics", analytics=(window[i]=window[i]||[]);if(!analytics.initialize)if(analytics.invoked)window.console&&console.error&&console.error("Snippet included twice.");else{analytics.invoked=!0;analytics.methods=["trackSubmit","trackClick","trackLink","trackForm","pageview","identify","reset","group","track","ready","alias","debug","page","once","off","on","addSourceMiddleware","addIntegrationMiddleware","setAnonymousId","addDestinationMiddleware"];analytics.factory=function(e){return function(){var t=Array.prototype.slice.call(arguments);t.unshift(e);analytics.push(t);return analytics}};for(var e=0;e<analytics.methods.length;e++){var key=analytics.methods[e];analytics[key]=analytics.factory(key)}analytics.load=function(key,e){var t=document.createElement("script");t.type="text/javascript";t.async=!0;t.setAttribute('data-global-customerio-analytics-key', i);t.src="https://cdp.customer.io/v1/analytics-js/snippet/" + key + "/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(t,n);analytics._writeKey=key;analytics._loadOptions=e};analytics.SNIPPET_VERSION="4.15.3";
        analytics.load(
            "58f554b322734a6ae65d"
            // Optional: enable anonymous in-app. See https://docs.customer.io/journeys/anonymous-in-app/#enable-anonymous-in-app-messaging.
            // {
            //   "integrations": {
            //     "Customer.io In-App Plugin": {
            //       anonymousInApp: true
            //     }
            //   }
            // }
        );
        analytics.page();
        }}();
    </script>
    <!-- END OF CUSTOMER.IO SNIPPET -->

    <div id="app" class="max-w-7xl mx-auto p-4 sm:p-6 lg:p-8">
        <!-- Navigation Bar -->
        <nav class="flex items-center justify-between flex-wrap bg-white p-6 rounded-xl shadow-lg mb-8 sticky top-4 z-10">
            <div class="flex items-center flex-shrink-0 text-blue-600 mr-6">
                <!-- Logo SVG: S(amir) T(est) S(ite) and larger text -->
                <svg class="h-8 w-8 mr-3 fill-current" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <circle cx="12" cy="12" r="10" class="text-blue-500" />
                    <text x="12" y="15" font-size="10" font-weight="bold" fill="white" text-anchor="middle">STS</text>
                </svg>
                <span class="font-bold text-3xl tracking-tight">Samir's Test Site</span>
            </div>
            <div id="nav-links" class="w-full block flex-grow lg:flex lg:items-center lg:w-auto">
                <!-- Links will be dynamically generated by JS -->
            </div>
            <div class="flex items-center" id="auth-actions">
                <span id="user-display" class="text-gray-600 text-sm mr-4 hidden sm:block"></span>
                <!-- Updated color for link -->
                <a id="signup-link" href="#signup" class="text-blue-600 hover:text-blue-800 font-semibold py-2 px-4 transition duration-150 ease-in-out hidden">Sign Up</a>
                <!-- Updated color for button -->
                <button id="auth-button" class="bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 px-4 rounded-lg transition duration-150 ease-in-out shadow-md" onclick="handleAuthClick()">
                    Login
                </button>
            </div>
        </nav>

        <!-- Main Content Area -->
        <main id="content-area" class="bg-white p-8 rounded-xl shadow-lg cio-page-content"></main>

        <!-- Console Log Instructions -->
        <div class="mt-8 p-4 bg-yellow-50 border-l-4 border-yellow-500 text-yellow-800 rounded-lg">
            <p class="font-bold">Live Tracking Enabled (CDP Client)</p>
            <p class="text-sm">Your Customer.io Write Key (<code class="bg-gray-100 p-1 rounded">58f554b322734a6ae65d</code>) has been integrated. You can now verify page views and user profiles directly in your Customer.io workspace.</p>
        </div>

    </div>

    <script>
        // Use 'cioanalytics' globally, which is the variable initialized by the CDP snippet.
        const cioanalytics = window.cioanalytics; 
        
        // --- DATA AND STATE MANAGEMENT ---
        const CONTENT = {
            // Logged Out Pages
            'home': { 
                title: 'Home', // Updated title
                content: 'Welcome to Samir\'s Test site! This is the home page where you will find yourself when logged out or visitng for the first time. Take a look around and don\'t hesitate to reach out if you need anything.' 
            },
            'features': { 
                title: 'Core Features', 
                content: 'We have a robust set of tools designed for the modern business.'
            },
            'pricing': { 
                title: 'Subscription Plans', 
                content: 'Choose the plan that fits your ambition.' 
            }, 
            'about': { 
                title: 'Our Story', 
                content: 'Founded in the innovative climate of the Bay Area in 2008, our SaaS company has consistently been on the cutting edge of modern communication platforms. Thanks to robust venture funding and a relentless focus on customer success, we are proud to offer a stable, scalable, and powerful platform to businesses worldwide.' 
            },
            'contact': { 
                title: 'Get In Touch', 
                content: 'We value your feedback and inquiries. Please see below for our contact method.' 
            },

            // Logged In Pages
            'dashboard': { title: 'User Dashboard', content: 'Welcome back! This is the first page seen after successful login. Customer.io was identified at login.' },
            'settings': { title: 'Account Settings', content: 'Manage your profile and preferences. Subsequent page calls are now linked to your identified user ID.' },
            'profile': { title: 'Edit Profile', content: 'Update your personal details. Events here are sent with your identified user context.' },
            'messages': { title: 'In-App Messages', content: 'View your recent in-app messages delivered via Customer.io. (Imagine they are rendered here).' },
            'reports': { title: 'Usage Reports', content: 'Access your analytics and usage data. Tracking these high-value pages is critical for segmenting active users.' },
        };

        let isLoggedIn = false;
        let currentUser = null;

        const el = {
            navLinks: document.getElementById('nav-links'),
            contentArea: document.getElementById('content-area'),
            authButton: document.getElementById('auth-button'),
            userDisplay: document.getElementById('user-display'),
            signupLink: document.getElementById('signup-link')
        };

        // --- AUTHENTICATION FUNCTIONS ---

        function checkSession() {
            const sessionData = sessionStorage.getItem('cio_auth_user');
            if (sessionData) {
                currentUser = JSON.parse(sessionData);
                isLoggedIn = true;
            } else {
                isLoggedIn = false;
                currentUser = null;
            }
        }

        function simulateLogin(email) {
            const userId = email.split('@')[0];
            const timestamp = Math.floor(Date.now() / 1000); // Unix timestamp

            currentUser = {
                id: userId,
                email: email,
                first_name: userId.charAt(0).toUpperCase() + userId.slice(1),
                created_at: timestamp,
                logged_in_at: timestamp
            };
            
            isLoggedIn = true;
            sessionStorage.setItem('cio_auth_user', JSON.stringify(currentUser));

            // CRITICAL: Call Customer.io identify() - Using CDP structure (ID, attributes)
            // Note: The CDP client accepts an ID as the first argument.
            cioanalytics.identify(currentUser.id, currentUser); 

            // Navigate to the dashboard after login/signup
            window.location.hash = '#dashboard';
        }

        function simulateLogout() {
            isLoggedIn = false;
            currentUser = null;
            sessionStorage.removeItem('cio_auth_user');
            
            // CRITICAL: Call Customer.io reset() for CDP client
            cioanalytics.reset();
            
            // Navigate back to the home page
            window.location.hash = '#home';
        }

        function handleAuthClick() {
            if (isLoggedIn) {
                simulateLogout();
            } else {
                // If not logged in, clicking the button routes to the login form
                window.location.hash = '#login';
            }
        }

        // --- RENDERING FUNCTIONS ---

        function getNavLinks() {
            const keys = isLoggedIn 
                ? ['dashboard', 'settings', 'profile', 'messages', 'reports']
                : ['home', 'features', 'pricing', 'about', 'contact'];
            
            return keys.map(key => `
                <!-- Updated hover color -->
                <a href="#${key}" class="block lg:inline-block mt-4 lg:mt-0 text-gray-700 hover:text-blue-600 mr-4 transition duration-150 ease-in-out font-medium p-2 rounded-lg">
                    ${CONTENT[key].title.split(' - ')[0]} <!-- Clean up title for navigation -->
                </a>
            `).join('');
        }

        function renderUI() {
            const currentHash = window.location.hash;
            
            // Update Auth Button and User Display
            if (isLoggedIn) {
                el.authButton.textContent = 'Logout';
                el.userDisplay.textContent = `Logged in as: ${currentUser.email}`;
                el.userDisplay.classList.remove('hidden');
                el.authButton.classList.add('bg-red-500', 'hover:bg-red-600');
                el.authButton.classList.remove('bg-blue-500', 'hover:bg-blue-600');
                el.signupLink.classList.add('hidden');
            } else {
                el.authButton.textContent = 'Login';
                el.userDisplay.classList.add('hidden');
                el.authButton.classList.add('bg-blue-500', 'hover:bg-blue-600');
                el.authButton.classList.remove('bg-red-500', 'hover:bg-red-600');

                // Show Sign Up link unless we are on the login or signup page
                if (currentHash === '#login' || currentHash === '#signup') {
                     el.signupLink.classList.add('hidden');
                } else {
                     el.signupLink.classList.remove('hidden');
                }
            }
            
            // Update Nav Links
            el.navLinks.innerHTML = getNavLinks();
        }

        function renderPage() {
            checkSession();
            renderUI(); // Render navigation and auth state first

            let currentHash = window.location.hash.substring(1) || 'home';

            // Redirect if trying to access protected content
            if (isLoggedIn && !CONTENT.hasOwnProperty(currentHash) && currentHash !== 'login' && currentHash !== 'signup') {
                currentHash = 'dashboard';
            } else if (!isLoggedIn && !CONTENT.hasOwnProperty(currentHash) && currentHash !== 'login' && currentHash !== 'signup') {
                currentHash = 'home';
            }
            
            // --- LOGIN PAGE RENDER ---
            if (currentHash === 'login') {
                if (isLoggedIn) {
                    window.location.hash = '#dashboard';
                    return;
                }
                el.contentArea.innerHTML = `
                    <div class="max-w-md mx-auto p-6 bg-gray-50 rounded-xl shadow-inner">
                        <h2 class="text-3xl font-bold text-gray-900 mb-6">Account Login</h2>
                        <form id="login-form">
                            <div class="mb-4">
                                <label for="email" class="block text-sm font-medium text-gray-700 mb-1">Email (e.g., test@example.com)</label>
                                <input type="email" id="email" name="email" required value="test@example.com"
                                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500"
                                    placeholder="yourname@domain.com">
                            </div>
                            <div class="mb-6">
                                <label for="password" class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                                <input type="password" id="password" name="password" required value="secret"
                                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500"
                                    placeholder="********">
                            </div>
                            <!-- Updated button color -->
                            <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg transition duration-150 ease-in-out shadow-md">
                                Log In
                            </button>
                        </form>
                    </div>
                `;

                // Add form submission listener
                document.getElementById('login-form').addEventListener('submit', function(e) {
                    e.preventDefault();
                    const email = document.getElementById('email').value;
                    simulateLogin(email);
                });
                
            } 
            // --- SIGNUP PAGE RENDER ---
            else if (currentHash === 'signup') {
                if (isLoggedIn) {
                    window.location.hash = '#dashboard';
                    return;
                }
                el.contentArea.innerHTML = `
                    <div class="max-w-md mx-auto p-6 bg-gray-50 rounded-xl shadow-inner">
                        <h2 class="text-3xl font-bold text-gray-900 mb-6">Create New Account</h2>
                        <form id="signup-form">
                            <div class="mb-4">
                                <label for="new-email" class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                                <input type="email" id="new-email" name="new-email" required value="newuser_${Math.floor(Math.random() * 1000)}@test.com"
                                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500"
                                    placeholder="yourname@domain.com">
                            </div>
                            <div class="mb-6">
                                <label for="new-password" class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                                <input type="password" id="new-password" name="new-password" required value="password123"
                                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500"
                                    placeholder="********">
                            </div>
                            <!-- Updated button color -->
                            <button type="submit" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg transition duration-150 ease-in-out shadow-md">
                                Sign Up & Identify User
                            </button>
                        </form>
                    </div>
                `;

                // Add form submission listener
                document.getElementById('signup-form').addEventListener('submit', function(e) {
                    e.preventDefault();
                    const email = document.getElementById('new-email').value;
                    // simulateLogin handles the CIO identify call, which is correct for signup
                    simulateLogin(email); 
                });
            }
            // --- REGULAR PAGES RENDER ---
            else {
                const pageData = CONTENT[currentHash];
                let customContentHtml = '';
                
                // Custom Home Page with Image
                if (currentHash === 'home') {
                    customContentHtml = `
                        <div class="flex flex-col lg:flex-row gap-8 items-center">
                            <div class="lg:w-1/2">
                                <p class="text-lg text-gray-600 leading-relaxed">${pageData.content}</p>
                            </div>
                            <div class="lg:w-1/2 rounded-xl overflow-hidden shadow-xl">
                                <img src="https://t3.ftcdn.net/jpg/02/30/25/62/240_F_230256262_6ByrARdtTZZtFVxUYPOngnIhu1XtmwBi.jpg" alt="Homepage visual" class="w-full h-auto object-cover rounded-lg">
                            </div>
                        </div>
                    `;
                }
                // Custom Features Page with List
                else if (currentHash === 'features') {
                    customContentHtml = `
                        <p class="text-lg text-gray-600 leading-relaxed mb-6">${pageData.content}</p>
                        <ul class="space-y-4 text-lg text-gray-700">
                            <li class="flex items-start">
                                <span class="text-blue-600 font-bold mr-3">&#9679;</span> 
                                Real-time Data Sync and API Access
                            </li>
                            <li class="flex items-start">
                                <span class="text-blue-600 font-bold mr-3">&#9679;</span> 
                                Advanced User Segmentation Engine
                            </li>
                            <li class="flex items-start">
                                <span class="text-blue-600 font-bold mr-3">&#9679;</span> 
                                Multi-channel Campaign Automation
                            </li>
                            <li class="flex items-start">
                                <span class="text-blue-600 font-bold mr-3">&#9679;</span> 
                                Customizable In-App Message Templates
                            </li>
                            <li class="flex items-start">
                                <span class="text-blue-600 font-bold mr-3">&#9679;</span> 
                                Comprehensive Analytics and Reporting
                            </li>
                        </ul>
                    `;
                }
                // Custom Pricing Page with Tiers
                else if (currentHash === 'pricing') {
                    customContentHtml = `
                        <p class="text-lg text-gray-600 leading-relaxed mb-8">${pageData.content}</p>
                        <div class="grid md:grid-cols-3 gap-8">
                            <!-- Free Plan -->
                            <div class="border border-gray-200 p-6 rounded-xl shadow-lg hover:shadow-xl transition duration-300">
                                <h3 class="text-2xl font-bold text-gray-700 mb-2">Free Tier</h3>
                                <p class="text-4xl font-extrabold mb-4">$0<span class="text-lg font-normal text-gray-500">/mo</span></p>
                                <p class="text-sm text-gray-500 mb-4">Perfect for getting started and testing the waters.</p>
                                <h4 class="font-semibold text-gray-800 mt-4 mb-2">Key Features:</h4>
                                <ul class="space-y-2 text-gray-700 text-sm">
                                    <li>&#10003; 1,000 Monthly Active Users</li>
                                    <li>&#10003; Basic Page & Event Tracking</li>
                                    <li>&#10003; Standard Reporting</li>
                                    <li class="text-gray-400">&#10007; Premium Support</li>
                                </ul>
                                <button class="mt-6 w-full bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 rounded-lg shadow-md">Start Free</button>
                            </div>

                            <!-- Plus Plan -->
                            <div class="border-4 border-blue-600 p-6 rounded-xl shadow-2xl bg-blue-50">
                                <h3 class="text-2xl font-bold text-blue-800 mb-2">Plus Plan</h3>
                                <p class="text-4xl font-extrabold mb-4">$49<span class="text-lg font-normal text-gray-500">/mo</span></p>
                                <p class="text-sm text-gray-600 mb-4">Scale your growth with advanced features.</p>
                                <h4 class="font-semibold text-blue-800 mt-4 mb-2">Key Features:</h4>
                                <ul class="space-y-2 text-gray-800 font-medium text-sm">
                                    <li>&#10003; 10,000 Monthly Active Users</li>
                                    <li>&#10003; Custom Events & Attributes</li>
                                    <li>&#10003; A/B Testing & Optimization</li>
                                    <li>&#10003; Email & Chat Support</li>
                                </ul>
                                <button class="mt-6 w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 rounded-lg shadow-md">Go Plus</button>
                            </div>

                            <!-- Premium Plan -->
                            <div class="border border-gray-200 p-6 rounded-xl shadow-lg hover:shadow-xl transition duration-300">
                                <h3 class="text-2xl font-bold text-gray-700 mb-2">Premium</h3>
                                <p class="text-4xl font-extrabold mb-4">$199<span class="text-lg font-normal text-gray-500">/mo</span></p>
                                <p class="text-sm text-gray-500 mb-4">Unlimited potential for enterprise-level businesses.</p>
                                <h4 class="font-semibold text-gray-800 mt-4 mb-2">Key Features:</h4>
                                <ul class="space-y-2 text-gray-700 text-sm">
                                    <li>&#10003; Unlimited Users</li>
                                    <li>&#10003; Dedicated Account Manager</li>
                                    <li>&#10003; API Access & Webhooks</li>
                                    <li>&#10003; 99.9% Uptime SLA</li>
                                </ul>
                                <button class="mt-6 w-full bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 rounded-lg shadow-md">Contact Sales</button>
                            </div>
                        </div>
                    `;
                }
                // Custom About Us Page with Images
                else if (currentHash === 'about') {
                    customContentHtml = `
                        <div class="flex flex-col lg:flex-row gap-8 mb-8">
                            <div class="lg:w-1/3 flex-shrink-0">
                                <img src="https://placehold.co/300x300/5A67D8/ffffff?text=CEO+Photo" alt="CEO photo" class="w-full h-auto object-cover rounded-xl shadow-lg">
                            </div>
                            <div class="lg:w-2/3">
                                <p class="text-lg text-gray-600 leading-relaxed">${pageData.content}</p>
                            </div>
                        </div>
                        <h3 class="text-2xl font-bold text-gray-800 mb-4 border-t pt-4">Our Team in Action</h3>
                        <div class="grid md:grid-cols-3 gap-4">
                            <img src="https://placehold.co/400x150/5A67D8/ffffff?text=Team+Collab+1" alt="Team collaborating" class="w-full h-auto object-cover rounded-lg shadow-md">
                            <img src="https://placehold.co/400x150/5A67D8/ffffff?text=Team+Collab+2" alt="Team collaborating" class="w-full h-auto object-cover rounded-lg shadow-md">
                            <img src="https://placehold.co/400x150/5A67D8/ffffff?text=Team+Collab+3" alt="Team collaborating" class="w-full h-auto object-cover rounded-lg shadow-md">
                        </div>
                    `;
                }
                // Custom Contact Page
                else if (currentHash === 'contact') {
                    customContentHtml = `
                        <p class="text-lg text-gray-600 leading-relaxed mb-4">${pageData.content}</p>
                        <p class="text-xl font-bold">Send us an email:</p>
                        <a href="mailto:test@test.com" class="text-2xl text-blue-600 hover:text-blue-800 font-extrabold transition duration-150">test@test.com</a>
                    `;
                }
                // Default rendering (Logged In Pages)
                else {
                    customContentHtml = `<p class="text-lg text-gray-600 leading-relaxed">${pageData.content}</p>`;
                }


                el.contentArea.innerHTML = `
                    <h1 class="text-4xl font-extrabold text-gray-900 mb-4">${pageData.title}</h1>
                    <!-- Updated text color -->
                    <span class="text-sm font-semibold text-blue-600 uppercase tracking-wider mb-6 inline-block p-1 px-3 bg-blue-100 rounded-full">
                        ${isLoggedIn ? 'LOGGED IN PAGE' : 'LOGGED OUT PAGE'}
                    </span>
                    <div class="mt-4">${customContentHtml}</div>

                    <div class="mt-8 pt-4 border-t border-gray-200">
                        <h3 class="text-xl font-semibold text-gray-800 mb-2">Tracking Status:</h3>
                        <p class="text-sm text-gray-500">
                            You are currently viewing the URL hash: <code class="bg-gray-100 p-1 rounded">#${currentHash}</code>. 
                            The 
                            <code class="bg-gray-100 p-1 rounded">cioanalytics.page()</code> 
                            method has been called. 
                        </p>
                    </div>
                `;
            }
            
            // CRITICAL: Call Customer.io page() for tracking after rendering the page
            // We only call page() for the content pages, not the form pages (login/signup)
            if (currentHash !== 'login' && currentHash !== 'signup') {
                cioanalytics.page(CONTENT[currentHash].title, { url_hash: currentHash });
            }
        }

        // --- INITIALIZATION ---
        
        // Listen for hash changes (for navigation)
        window.addEventListener('hashchange', renderPage);

        // Run on initial load
        document.addEventListener('DOMContentLoaded', () => {
            // If no hash is set, default to #home
            if (!window.location.hash) {
                window.location.hash = '#home';
            }
            renderPage();
        });

    </script>
</body>
</html>
